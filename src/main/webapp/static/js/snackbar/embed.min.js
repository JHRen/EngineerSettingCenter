function sskcheckMobile(){var t=navigator.userAgent.match(/iPad/i)!=null,n;return t?!1:(n=navigator.userAgent.match(/iphone|android|phone|mobile|wap|netfront|x11|java|opera mobi|opera mini|ucweb|windows ce|symbian|symbianos|series|webos|sony|blackberry|dopod|nokia|samsung|palmsource|xda|pieplus|meizu|midp|cldc|motorola|foma|docomo|up.browser|up.link|blazer|helio|hosin|huawei|novarra|coolpad|webos|techfaith|palmsource|alcatel|amoi|ktouch|nexian|ericsson|philips|sagem|wellcom|bunjalloo|maui|smartphone|iemobile|spice|bird|zte-|longcos|pantech|gionee|portalmmm|jig browser|hiptop|benq|haier|^lct|320x320|240x320|176x220/i)!=null,n)?!0:!1}function sskua(n){var t=[],r="",i;return(t=n.match(/FireFox\/([^\s]+)/ig))?(i=t[0].split("/"),r='<span class="ua_firefox"><i class="fa fa-globe"><\/i> Mozilla FireFox|'+i[1]):(t=n.match(/Maxthon([\d]*)\/([^\s]+)/ig))?(i=t[0].split("/"),r='<span class="ua_maxthon"><i class="fa fa-globe"><\/i> Maxthon'):(t=n.match(/BIDUBrowser([\d]*)\/([^\s]+)/ig))?(i=t[0].split("/"),r='<span class="ua_ucweb"><i class="fa fa-globe"><\/i> 百度浏览器|'+i[1]):(t=n.match(/UBrowser([\d]*)\/([^\s]+)/ig))?(i=t[0].split("/"),r='<span class="ua_ucweb"><i class="fa fa-globe"><\/i> UCBrowser|'+i[1]):(t=n.match(/UCBrowser([\d]*)\/([^\s]+)/ig))?(i=t[0].split("/"),r='<span class="ua_ucweb"><i class="fa fa-globe"><\/i> UCBrowser|'+i[1]):(t=n.match(/MetaSr/ig))?r='<span class="ua_sogou"><i class="fa fa-globe"><\/i> 搜狗浏览器':(t=n.match(/2345Explorer/ig))?r='<span class="ua_2345explorer"><a href="http://ssk.91txh.com/2345download.php?id=2" target="_blank" style="color:#FFFFFF!important;"><i class="fa fa-globe"><\/i> 2345王牌浏览器<\/a>':(t=n.match(/2345chrome/ig))?r='<span class="ua_2345chrome"><a href="http://ssk.91txh.com/2345download.php?id=3" target="_blank" style="color:#FFFFFF!important;"><i class="fa fa-globe"><\/i> 2345加速浏览器<\/a>':(t=n.match(/LBBROWSER/ig))?r='<span class="ua_lbbrowser"><i class="fa fa-globe"><\/i> 猎豹安全浏览器':(t=n.match(/MicroMessenger\/([^\s]+)/ig))?(i=t[0].split("/"),r='<span class="ua_qq"><i class="fa fa-weixin"><\/i> 微信|'+i[1]):(t=n.match(/QQBrowser\/([^\s]+)/ig))?(i=t[0].split("/"),r='<span class="ua_qq"><i class="fa fa-globe"><\/i> QQ浏览器|'+i[1]):(t=n.match(/QQ\/([^\s]+)/ig))?(i=t[0].split("/"),r='<span class="ua_qq"><i class="fa fa-globe"><\/i> QQ浏览器|'+i[1]):(t=n.match(/MiuiBrowser\/([^\s]+)/ig))?(i=t[0].split("/"),r='<span class="ua_mi"><i class="fa fa-globe"><\/i> Miui浏览器|'+i[1]):(t=n.match(/Edge([\d]*)\/([^\s]+)/ig))?(i=t[0].split("/"),r='<span class="ua_ie"><i class="fa fa-globe"><\/i> Edge|'+i[1]):(t=n.match(/Chrome([\d]*)\/([^\s]+)/ig))?(i=t[0].split("/"),r='<span class="ua_chrome"><i class="fa fa-globe"><\/i> Chrome|'+i[1]):(t=n.match(/safari\/([^\s]+)/ig))?(i=t[0].split("/"),r='<span class="ua_apple"><i class="fa fa-globe"><\/i> Apple Safari|'+i[1]):(t=n.match(/Opera[\s|\/]([^\s]+)/ig))?(i=t[0].split("/"),r='<span class="ua_opera"><i class="fa fa-globe"><\/i> Opera|'+t[1]):r=(t=n.match(/Trident\/7.0/gi))?'<span class="ua_ie"><i class="fa fa-globe"><\/i> Internet Explorer 11':(t=n.match(/MSIE\s([^\s|;]+)/gi))?'<span class="ua_ie"><i class="fa fa-globe"><\/i> Internet Explorer|'+t[0]:'<span class="ua_other"><i class="fa fa-globe"><\/i> 其它浏览器',Mobile=sskcheckMobile()?"<br><br>":"",r+"<\/span>"+Mobile}function sskos(n){var t="";return t=n.match(/win/ig)?n.match(/nt 5.1/ig)?'<span class="os_xp"><i class="fa fa-desktop"><\/i> Windows XP':n.match(/nt 6.1/ig)?'<span class="os_7"><i class="fa fa-desktop"><\/i> Windows 7':n.match(/nt 6.2/ig)?'<span class="os_8"><i class="fa fa-desktop"><\/i> Windows 8':n.match(/nt 6.3/ig)?'<span class="os_8_1"><i class="fa fa-desktop"><\/i> Windows 8.1':n.match(/nt 10.0/ig)?'<span class="os_8_1"><i class="fa fa-desktop"><\/i> Windows 10':n.match(/nt 6.0/ig)?'<span class="os_vista"><i class="fa fa-desktop"><\/i> Windows Vista':n.match(/nt 5/ig)?'<span class="os_2000"><i class="fa fa-desktop"><\/i> Windows 2000':'<span class="os_windows"><i class="fa fa-desktop"><\/i> Windows':n.match(/android/ig)?'<span class="os_android"><i class="fa fa-android"><\/i> Android':n.match(/ubuntu/ig)?'<span class="os_ubuntu"><i class="fa fa-desktop"><\/i> Ubuntu':n.match(/linux/ig)?'<span class="os_linux"><i class="fa fa-linux"><\/i> Linux':n.match(/mac/ig)?'<span class="os_mac"><i class="fa fa-desktop"><\/i> Mac OS X':n.match(/unix/ig)?'<span class="os_unix"><i class="fa fa-desktop"><\/i> Unix':n.match(/symbian/ig)?'<span class="os_nokia"><i class="fa fa-mobile"><\/i> Nokia SymbianOS':'<span class="os_other"><i class="fa fa-desktop"><\/i> 其它操作系统',t+"<\/span>"}!function(n,t,i){function p(){return f.short_name?dt+"//"+f.short_name+"."+r.DOMAIN:r.REMOTE}function bi(){function i(){for(var i,u,r;i=li.shift();){u=i.url;r=new t(i.title,{dir:"auto",icon:i.iconUrl,body:i.body});try{r.onclick=function(){n.focus();rt.href=u;r.close()}}catch(f){}setTimeout(function(){r.close&&r.close()},8e3)}}var t=n.Notification;"Notification"in n&&"denied"!==t.permission&&("granted"===t.permission&&i(),t.requestPermission(function(n){"granted"===n&&i()}))}function g(){return 0==c.data.user_id}function hi(n){r.theme=n;"none"!=n&&o.injectStylesheet(r.STATIC_URL+"/styles/embed"+(n?"."+n+".css?"+nr[n]:"."+short_name)+".css")}var o={},ci=t.getElementsByTagName("head")[0]||t.getElementsByTagName("body")[0],ki,ft,ot,l,ii;if(o.extend=function(n,t){for(var i in t)n[i]=t[i];return n},o.injectScript=function(r,u){var f=t.createElement("script"),e=t.head||t.getElementsByTagName("head")[0]||t.documentElement;f.type="text/javascript";f.src=r;f.async="async";f.charset="utf-8";u&&(f.onload=f.onreadystatechange=function(t,r){var o=r||!f.readyState||/loaded|complete/.test(f.readyState);o&&(f.onload=f.onreadystatechange=null,e&&f.parentNode&&e.removeChild(f),f=i,r||u.call(n))});e.insertBefore(f,e.firstChild)},o.injectStylesheet=function(n){var i=t.createElement("link");i.type="text/css";i.rel="stylesheet";i.href=n;ci.appendChild(i)},o.injectStyle=function(n){var i=t.createElement("style");return i.type="text/css",ci.appendChild(i),n=n.replace(/\}/g,"}\n"),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(t.createTextNode(n)),i},o.getCookie=function(n){for(var r,u,e,o=" "+n+"=",s=t.cookie.split(";"),f=0;f<s.length;f++)if(r=" "+s[f],u=r.indexOf(o),u>=0&&u+o.length==(e=r.indexOf("=")+1))return decodeURIComponent(r.substring(e,r.length).replace(/\+/g,""));return i},o.param=function(n){var r=[];for(var t in n)n[t]!=i&&r.push(t+"="+encodeURIComponent(n[t]));return r.join("&")},o.cssProperty=function(n,i){var u=(t.body||t.documentElement).style;if("undefined"==typeof u)return!1;if("string"==typeof u[n])return i?n:!0;for(var f=["Moz","Webkit","ms"],n=n.charAt(0).toUpperCase()+n.substr(1),r=0;r<f.length;r++)if("string"==typeof u[f[r]+n])return i?f[r]+n:!0},!n.DUOSHUO){for(ki in Object.prototype)return alert("Object.prototype 不为空，请不要给 Object.prototype 设置方法");var f,h,w=n.JSON,rt=n.location,bt=n.XMLHttpRequest,a=w&&w.stringify&&n.localStorage,kt=n.navigator.userAgent,dt="https:"==t.location.protocol?"https:":"http:",gt=0,li=[],b=h=function(){function n(n){return t[n]||"&amp;"}var t={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=/&(?!\w+;)|[<>"'`]/g,r=/[&<>"'`]/;return function(t){return null==t||t===!1?"":r.test(t)?t.replace(i,n):t}}(),di=function(n){if(n.match(/^(http|https):/))return n;var i=t.createElement("a");return i.href=n,v.hrefNormalized?i.href:i.getAttribute("href",4)},ai=function(n){return function(){return n}},ht=function(){for(var i,t={},n=0;n<arguments.length;n++)arguments[n]&&o.extend(t,arguments[n]);return i=o.param(t),i?"?"+i:""},ni=function(){var n=o.getCookie("duoshuo_token");return n?{jwt:n}:f.remote_auth?{short_name:f.short_name,remote_auth:f.remote_auth}:i},ti=function(){if(!f&&(f=n.duoshuoQuery)){if(!f.short_name||"your_duoshuo_short_name"===f.short_name)return f=i,void alert("你还没有设置多说域名(duoshuoQuery.short_name)，填入已有域名或创建新站点：http://duoshuo.com/create-site/");wi.trigger("queryDefined")}return f},k=function(n){return n&&n.error&&n.warn?n:{error:function(){},log:function(){},warn:function(){}}}(n.console),r=n.DUOSHUO={sourceName:{weibo:"新浪微博",qq:"QQ",qzone:"QQ空间",qqt:"腾讯微博",renren:"人人网",douban:"豆瓣网",kaixin:"开心网",sohu:"搜狐微博",baidu:"百度",google:"谷歌",wechat:"微信",weixin:"微信",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin"},serviceNames:{weibo:"微博",qq:"QQ",douban:"豆瓣",renren:"人人",kaixin:"开心",baidu:"百度",google:"谷歌",wechat:"微信",weixin:"微信",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin"},parseDate:function(n){return n.parse("2011-10-28T00:00:00+08:00")&&function(t){return new n(t)}||n.parse("2011/10/28T00:00:00+0800")&&function(t){return new n(t.replace(/-/g,"/").replace(/:(\d\d)$/,"$1"))}||n.parse("2011/10/28 00:00:00+0800")&&function(t){return new n(t.replace(/-/g,"/").replace(/:(\d\d)$/,"$1").replace("T"," "))}||function(t){return new n(t)}}(Date),fullTime:function(n){var t=r.parseDate(n);return t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日 "+t.toLocaleTimeString()},elapsedTime:function(n){var i=r.parseDate(n),u=new Date,t=(u-gt-i)/1e3;return 10>t?"刚刚":60>t?Math.round(t)+"秒前":3600>t?Math.round(t/60)+"分钟前":86400>t?Math.round(t/3600)+"小时前":(u.getFullYear()==i.getFullYear()?"":i.getFullYear()+"年")+(i.getMonth()+1)+"月"+i.getDate()+"日"},compileStyle:function(n){var t="",r={},i;if(r.textbox="#ds-thread #ds-reset .ds-replybox .ds-textarea-wrapper",!n)return t;for(i in n)t+=r[i]+"{"+n[i]+"}\n";return t},init:function(n,t){n&&!ct[n]&&(ct[n]=t||{type:"EmbedThread"});r.initView&&r.initView()}},gi=t.all,v=r.support=function(){var r=t.createElement("div");r.innerHTML='<a href="/a" style="opacity:.55;">a<\/a><input type="checkbox"/>';var u=r.getElementsByTagName("a")[0],f=r.getElementsByTagName("input")[0],i={placeholder:"placeholder"in f,touch:"ontouchstart"in n||"onmsgesturechange"in n,opacity:/^0.55$/.test(u.style.opacity),hrefNormalized:"/a"===u.getAttribute("href"),iOS:kt.match(/ \((iPad|iPhone|iPod);( U;)? CPU( iPhone)? OS /),android:kt.match(/ \(Linux; U; Android /)};return i.ie6=!bt&&"undefined"==typeof r.style.maxHeight,i.authInWin=n.postMessage&&n.screen.width>800&&!i.iOS&&!i.android&&rt.origin,i}(),ct=r.selectors={".ds-thread":{type:"EmbedThread"},".ds-recent-comments":{type:"RecentComments"},".ds-recent-visitors":{type:"RecentVisitors"},".ds-top-users":{type:"TopUsers"},".ds-top-threads":{type:"TopThreads"},".ds-login":{type:"LoginWidget"},".ds-thread-count":{type:"ThreadCount"},".ds-share":{type:"ShareWidget"}},ut=r.openDialog=function(n){return r.dialog!==i&&r.dialog.el.remove(),r.dialog=new e.Dialog(u.dialog(n)).open()},vi=r.smilies={};for(r.require=function(){function i(n){var t=yi[n]?"?"+yi[n]+".js":"";return r.STATIC_URL+"/libs/"+n+".js"+t}var t={mzadxN:"undefined"!=typeof mzadxN};return"undefined"!=typeof jQuery&&jQuery.fn.jquery>="1.5"&&(t["embed.compat"]=!0,r.jQuery=n.jQuery),function(n,r){if("string"==typeof n)t[n]?r():o.injectScript(i(n),function(){t[n]=!0;r()});else if("object"==typeof n){for(var f=!0,u=0;u<n.length;u++)(function(e){t[n[u]]||(f=!1,o.injectScript(i(e),function(){t[e]=!0;for(var i=0;i<n.length;i++)if(!t[n[i]])return;r()}))})(n[u]);f&&r()}}}(),ft=0,ot=["EmbedThread","RecentComments","RecentVisitors","TopUsers","TopThreads","LoginWidget","ThreadCount"];ft<ot.length;ft++)r[ot[ft]]=function(n){return function(t,i){i=i||{};i.type=n;t&&!ct[t]&&(ct[t]=i);r.initSelector&&r.initSelector(t,i)}}(ot[ft]),r["create"+ot[ft]]=function(n){return function(i,u){var f=t.createElement(i);for(var e in u)f.setAttribute("data-"+e,u[e]);return r[n](f),f}}(ot[ft]);r.RecentCommentsWidget=r.RecentComments;l=r.API={ajax:function(n,t,u,e,s){function g(n){var t=n.getResponseHeader("Date");t&&(gt=new Date-new Date(t))}function v(n,t,i){var r,f,o,u=t;if(n>=200&&300>n||304===n)if(304===n)u="notmodified",o=!0;else try{r=w.parse(i);u="success";o=!0}catch(c){u="parsererror";f=c}else{f=u;(!u||n)&&(u="error",0>n&&(n=0));try{r=w.parse(i)}catch(c){u="parsererror";f=c}}o?e&&e(r):"parseerror"===u?k.error("解析错误: "+i):(k.error("出错啦("+r.code+"): "+r.errorMessage),s&&s(r),r.errorTrace&&k.error(r.errorTrace));g(h)}var y=o.getCookie("duoshuo_token"),b,h,d,c,a;if(u=u||{},u.v=r.version,y?u.jwt=y:f.remote_auth&&(u.remote_auth=f.remote_auth),b=bt&&w&&w.parse,b&&(h=new bt,d=!!h&&"withCredentials"in h,d))return h.open(n,p()+"/api/"+t+".json"+("GET"==n?"?"+o.param(u):""),!0),h.withCredentials=!0,h.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),h.send("GET"==n?null:o.param(u)),c=function(n,t){var f,r,e,u;try{if(c&&(t||4===h.readyState))if(c=i,t)4!==h.readyState&&h.abort();else{f=h.status;e=h.getAllResponseHeaders();try{u=h.responseText}catch(n){}try{r=h.statusText}catch(s){r=""}}}catch(o){t||v(-1,o)}u&&v(f,r,u,e)},void(4===h.readyState?c():h.onreadystatechange=c);"GET"!=n&&(u._method="POST");a="cb_"+Math.round(1e6*Math.random());l[a]=function(n){switch(n.code){case 0:e&&e(n);break;default:s&&s(n);k.error("出错啦("+n.code+"): "+n.errorMessage);n.errorTrace&&k.error(n.errorTrace)}};u.callback="DUOSHUO.API['"+a+"']";o.injectScript(p()+"/api/"+t+".jsonp?"+o.param(u))},get:function(n,t,i,r){return this.ajax("GET",n,t,i,r)},post:function(n,t,i,r){return this.ajax("POST",n,t,i,r)}};ii=r.ws={messages:[],send:function(i){var u,e,f;if(!("WebSocket"in n&&w))return!1;u=this;(u.messages.push(w.stringify(i)),u.webSocket)||(e="https:"===t.location.protocol?"wss://ws.duoshuo.com:8202/":"ws://ws.duoshuo.com:8201/",f=u.webSocket=new WebSocket(e),f.onopen=function(){var n,t=1===f.readyState;if(t)for(;n=u.messages.shift();)f.send(n)},f.onmessage=function(n){var t,u,i;try{t=w.parse(n.data)}catch(f){return}switch(t.type){case"post":for(i=0;i<r.pagelets.length;i++)u=r.pagelets[i],u.threadId==t.thread_id&&u.onMessage(t);break;case"notification":li.push(t);bi()}},n.addEventListener("beforeunload",function(){f.close()}));u.webSocket.onopen()}};r.DOMAIN="duoshuo.com";r.STATIC_URL=dt+"//static.duoshuo.com";r.REMOTE=dt+"//duoshuo.com";r.version="16.6.16";var nr={"default":"9b2a46a0",dark:"33f3a5ac",bluebox:"39a75d50",newhua:"706ba4eb",justflat:"9d72ec5a"},yi={"embed.compat":"24f8ca3f",smilies:"921e8eda"},s={post:"发布",posting:"正在发布",settings:"设置",reply:"回复",like:"顶",repost:"转发",report:"举报","delete":"删除",reply_to:"回复 ",reposts:"转发",comments:"评论",floor:"楼",latest:"最新",earliest:"最早",hottest:"最热",share_to:"分享到:",leave_a_message:"说点什么吧…",no_comments_yet:"还没有评论，沙发等你来抢",repost_reason:"请输入转发理由",hot_posts_title:"被顶起来的评论",comments_zero:"暂无评论",comments_one:"1条评论",comments_multiple:"{num}条评论",reposts_zero:"暂无转发",reposts_one:"1条转发",reposts_multiple:"{num}条转发",weibo_reposts_zero:"暂无新浪微博",weibo_reposts_one:"1条新浪微博",weibo_reposts_multiple:"{num}条新浪微博",qqt_reposts_zero:"暂无腾讯微博",qqt_reposts_one:"1条腾讯微博",qqt_reposts_multiple:"{num}条腾讯微博"},at={get:function(n){if(a)return a[n]},save:function(n,t){if(a)try{a.removeItem(n);a[n]=w.stringify(t);a.removeItem(n+":timestamp");a[n+":timestamp"]=Math.floor((new Date-gt)/1e3)}catch(i){}}},vt=r.loadRequire=function(t){var i;if(t.visitor&&(!c.data&&t.visitor.user_id&&n.Notification&&ii.send({logged_user_id:t.visitor.user_id}),c.reset(t.visitor)),t.site&&(et.reset(t.site),at.save("ds_site_"+f.short_name,t.site)),!r.theme&&et.data.theme&&hi(et.data.theme),t.lang&&(o.extend(s,t.lang),at.save("ds_lang_"+f.short_name,t.lang)),t.stylesheets)for(i=0;i<t.stylesheets.length;i++)o.injectStylesheet(t.stylesheets[i]);if(t.nonce&&(r.nonce=t.nonce),t.style&&o.injectStyle((t.style||"")+r.compileStyle(f.component_style)),t.unread&&tt.reset(t.unread),t.warnings)for(i=0;i<t.warnings.length;i++)k.warn(t.warnings[i])},ri=0,pi=r.Class=function(){};pi.extend=function(n){function t(){!ri&&this.init&&this.init.apply(this,arguments)}var i,r;ri=1;i=new this;ri=0;for(r in n)i[r]=n[r];return t.prototype=i,t.prototype.constructor=t,t.extend=arguments.callee,t};var yt=r.Event=pi.extend({on:function(n,t){var r=this.handlers||(this.handlers={});return r[n]===i&&(r[n]=[]),r[n].push(t),this},trigger:function(n,t){var r=(this.handlers||(this.handlers={}))[n],i;if(r)for(i=0;i<r.length&&r[i].call(this,t)!==!1;i++);return this}}),nt=r.Widget=yt.extend({init:function(n,t){this.el=n;this.options=t||{};this.render()},render:function(){},reset:function(){},load:function(n){switch(n.code){case 0:vt(n);var t=this.prepare(n);t.options=o.extend(this.options,n.options);this.onload(t);break;default:this.onError(n)}},onload:function(n){this.el.html(u[this.tmpl](n))},prepare:function(n){return n},onMessage:function(){},onError:function(n){k.error("出错啦("+n.code+"): "+n.errorMessage);n.errorTrace&&k.error(n.errorTrace)}}),lt=r.Model=yt.extend({init:function(n){this.data=n},reset:function(n){this.data=n;this.trigger("reset")},remove:function(n){this.data.splice(n,1);this.trigger("reset")},set:function(n,t){if(t===i)for(var r in n)this.data[r]=n[r];else this.data[n]=t;return this.trigger("reset"),this},toJSON:function(){return o.extend({},this.data)}}),ui=lt.extend({toJSON:function(){return o.extend({},this.data)}}),pt=lt.extend({toJSON:function(){var n=o.extend({},this.data);return n.theAuthor=it[this.data.author_id]&&it[this.data.author_id].data||this.data.author,n.parents=this.data.parents||[],n}}),fi=lt.extend({toJSON:function(){return o.extend({},this.data)}}),st=function(n){this.model=n};st.prototype.set=function(n){for(var t in n)n[t]&&(this[t]?this[t].set(n[t]):this[t]=new this.model(n[t]))};st.prototype.get=function(n){for(var t=0,i=[];t<n.length;t++)i[t]=this[n[t]];return i};st.prototype.getJSON=function(n){for(var t=0,i=[];t<n.length;t++)this[n[t]]&&i.push(this[n[t]].toJSON());return i};var d={userUrl:function(n){return n.url},avatarUrl:function(n){return n.avatar_url||et.data.default_avatar_url},loginUrl:function(n,t){return t||(t={}),f.sso&&f.sso.login&&(t.sso=1,t.redirect_uri=f.sso.login),p()+"/login/"+n+"/"+ht(t)},bindUrl:function(n){return p()+"/bind/"+n+"/"+ht(f.sso&&f.sso.login?{sso:1,redirect_uri:f.sso.login}:null,ni())},logoutUrl:function(){return p()+"/logout/"+ht(f.sso&&f.sso.logout?{sso:1,redirect_uri:f.sso.logout}:null)}},ei=["weixin","weibo","qq","renren"],oi=["douban","kaixin","baidu","google"],u=r.templates={userAnchor:function(n){return n.url?'<a rel="nofollow author" target="_blank" href="'+b(n.url)+'">'+b(n.name)+"<\/a>":b(n.name)},avatarImg:function(n,t){return'<img src="'+b(d.avatarUrl(n,t))+'" alt="'+b(n.name)+'"'+(t?' style="width:'+t+"px;height:"+t+'px"':"")+"/>"},avatar:function(n,t){var i=u.avatarImg(n,t),r=d.userUrl(n);return r?'<a rel="nofollow author" target="_blank" href="'+b(r)+'" '+(n.user_id?" onclick=\"this.href='"+p()+"/user-url/?user_id="+n.user_id+"';\"":"")+' title="'+b(n.name)+'">'+i+"<\/a>":i},timeText:function(n){return n?'<span class="ds-time" datetime="'+n+'" title="'+r.fullTime(n)+'">'+r.elapsedTime(n)+"<\/span>":""},timeAnchor:function(n,t){return n?'<a href="'+t+'" target="_blank" rel="nofollow" class="ds-time" datetime="'+n+'" title="'+r.fullTime(n)+'">'+r.elapsedTime(n)+"<\/a>":""},serviceIcon:function(n,t){return'<a href="javascript:void(0)" class="ds-service-icon'+(t?"-grey":"")+" ds-"+n+'" data-service="'+n+'" title="'+r.sourceName[n]+'"><\/a>'},poweredBy:function(n){return'<p class="ds-powered-by"><a href="http://duoshuo.com" target="_blank" rel="nofollow">'+b(n)+"<\/a><\/p>"},indicator:ai('<div id="ds-indicator"><\/div>'),waitingImg:ai('<div id="ds-waiting"><\/div>'),loginItem:function(n,t){var i=d[t?"bindUrl":"loginUrl"](n);return'<li>    <a href="'+i+'" rel="nofollow" class="ds-service-link ds-'+n+'">'+r.serviceNames[n]+(c.data.social_uid[n]?' <span class="ds-icon ds-icon-ok"><\/span>':"")+"<\/a><\/li>"}},si=function(n){var t=[];for(var i in n)t.push('<input type="hidden" name="'+i+'" value="'+b(n[i])+'" />');return t.join("\n")};u.commentList=function(n){var i="",r=n.list,t,f,e;if(r)for(f=-1,e=r.length-1;e>f;)t=r[f+=1],i+='<li class="ds-comment',n.options.show_avatars&&(i+=" ds-show-avatars"),i+='" data-post-id="'+t.post_id+'">',n.options.show_avatars&&(i+='<div class="ds-avatar">'+u.avatar(t.theAuthor,n.options.avatar_size)+"<\/div>"),i+='<div class="ds-meta">'+u.userAnchor(t.theAuthor),n.options.show_time&&(i+=u.timeText(t.created_at)),i+="<\/div>",i+=n.options.show_title?'<div class="ds-thread-title">在 <a href="'+h(t.thread.url)+'#comments">'+h(t.thread.title)+'<\/a> 中评论<\/div><div class="ds-excerpt">'+t.message+"<\/div>":'<a class="ds-excerpt" title="'+t.thread.title+' 中的评论" href="'+h(t.thread.url)+'#comments">'+t.message+"<\/a>",i+="<\/li>";return i};u.ctxPost=function(n){var t="";return n.post&&(t+='<li class="ds-ctx-entry"',n.hidden&&(t+=' style="display:none"'),t+=' data-post-id="'+n.post.post_id+'"><div class="ds-avatar">'+u.avatar(n.post.theAuthor||n.post.author)+'<\/div><div class="ds-ctx-body"><div class="ds-ctx-head">'+u.userAnchor(n.post.theAuthor||n.post.author)+u.timeAnchor(n.post.created_at,n.post.url),n.index>=0&&(t+='<div class="ds-ctx-nth" title="'+r.fullTime(n.post.created_at)+'">'+(n.index+1)+s.floor+"<\/div>"),t+='<\/div><div class="ds-ctx-content">'+n.post.message,n.index>=0&&(t+='　　　　　　　<div class="ds-comment-actions',n.post.vote>0&&(t+=" ds-post-liked"),t+='">'+u.likePost(n.post)+'<a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"><\/span>'+s.repost+'<\/a><a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"><\/span>'+s.reply+"<\/a><\/div>"),t+="<\/div><\/div><\/li>"),t};u["dialog-anonymous"]=function(n){var t='<h2>社交帐号登录<\/h2><div class="ds-icons-32">',u=n.services,i,f,e;if(u)for(f=-1,e=u.length-1;e>f;)i=u[f+=1],t+='<a class="ds-'+i+'" href="'+d.loginUrl(i)+'">'+r.sourceName[i]+"<\/a>";return t+="<\/div>",n.options.deny_anonymous||(t+='<h2>作为游客留言<\/h2><form><div class="ds-control-group"><input type="text" name="author_name" id="ds-dialog-name" value="'+h(c.data.name)+'" required /><label for="ds-dialog-name">名字(必填)<\/label><\/div>',n.options.require_guest_email&&(t+='<div class="ds-control-group"><input type="email" name="author_email" id="ds-dialog-email" value="'+h(c.data.email)+'" required /><label for="ds-dialog-email">邮箱(必填)<\/label><\/div>'),n.options.require_guest_url&&(t+='<div class="ds-control-group"><input type="url" name="author_url" id="ds-dialog-url" placeholder="http://" value="'+h(c.data.url)+'" /><label for="ds-dialog-url">网址(可选)<\/label><\/div>'),t+='<button type="submit">发布<\/button><\/form>'),t};u["dialog-ask-for-auth"]=function(){return'<h2>社交帐号登录<\/h2><ul class="ds-service-list">'+u.serviceList(ei)+'<\/ul><ul class="ds-service-list ds-additional-services">'+u.serviceList(oi)+"<\/ul>"};u["dialog-bind-more"]=function(){return'<h2>绑定更多帐号<\/h2><ul class="ds-service-list">'+u.serviceBindList(ei)+'<\/ul><ul class="ds-service-list ds-additional-services">'+u.serviceBindList(oi)+'<\/ul><div style="clear:both"><\/div>'};u["dialog-qrcode"]=function(n){return'<h2>微信扫一扫，分享到朋友圈<\/h2><div class="ds-share-qrcode" style="text-align:center;"><img src="'+n.qrcode_url+'" alt="'+n.url+'"><\/div>'};u["dialog-reposts"]=function(n){var t='<h2>转发到微博<\/h2><div class="ds-quote"><strong>@'+h(n.post.theAuthor.name)+"<\/strong>: "+n.post.message+"<\/div><form>"+si({post_id:n.post.post_id})+'<div class="ds-textarea-wrapper"><textarea name="message" title="Ctrl+Enter快捷提交" placeholder="'+h(s.repost_reason)+'">'+h(n.repostMessage)+'<\/textarea><pre class="ds-hidden-text"><\/pre>';return t+='<\/div><div class="ds-actions">',n.service?t+=si({"service[]":n.service}):(t+='<label><input type="checkbox" name="service[]" value="weibo"',c.data.social_uid.weibo&&(t+=' checked="checked"'),t+=' /><span class="ds-service-icon ds-weibo"><\/span>新浪微博<\/label><label><input type="checkbox" name="service[]" value="qqt"',c.data.social_uid.qq&&(t+=' checked="checked"'),t+=' /><span class="ds-service-icon ds-qqt"><\/span>腾讯微博<\/label>'),t+('<button type="submit">'+s.repost+"<\/button><\/div><\/form>")};u.dialog=function(n){return'<div class="ds-dialog"><div class="ds-dialog-inner ds-rounded"><div class="ds-dialog-body">'+n+'<\/div><div class="ds-dialog-footer"><a href="http://duoshuo.com/" target="_blank" class="ds-logo"><\/a><span>社会化评论框<\/span><\/div><a class="ds-dialog-close" href="javascript:void(0)" title="关闭"><\/a><\/div><\/div>'};u.hotPosts=function(n){var r='<div class="ds-header ds-gradient-bg">'+h(s.hot_posts_title)+"<\/div><ul>",t=n.list,f,i,e;if(t)for(i=-1,e=t.length-1;e>i;)f=t[i+=1],r+=u.post({post:f,options:n.options});return r+"<\/ul>"};u.likePost=function(n){var t='<a class="ds-post-likes" href="javascript:void(0);"><span class="ds-icon ds-icon-like"><\/span>'+s.like;return n.likes>0&&(t+="("+n.likes+")"),t+"<\/a>"};u.likeTooltip=function(n){var i='<div class="ds-like-tooltip ds-rounded"><p>很高兴你能喜欢，分享一下吧：<\/p><ul>';for(var t in n.services)i+='<li><a class="ds-share-to-'+t+" ds-service-link ds-"+t+'" href="'+p()+"/share-proxy/?"+o.param({service:t,thread_id:n.thread_id})+'">'+n.services[t]+"<\/a><\/li>";return i+'<\/ul><p class="ds-like-tooltip-footer"><a class="ds-like-tooltip-close">算了<\/a><\/p><\/div>'};u.loginButtons=function(){return'<div class="ds-login-buttons"><p>社交帐号登录:<\/p><div class="ds-social-links"><ul class="ds-service-list">'+u.serviceList(ei)+'<li><a class="ds-more-services" href="javascript:void(0)">更多»<\/a><\/li><\/ul><ul class="ds-service-list ds-additional-services">'+u.serviceList(oi)+"<\/ul><\/div><\/div>"};u.loginWidget=function(n){var f='<div class="ds-icons-32">',i=n,t,u,e;if(i)for(u=-1,e=i.length-1;e>u;)t=i[u+=1],f+='<a class="ds-'+t+'" href="'+d.loginUrl(t)+'">'+r.sourceName[t]+"<\/a>";return f+"<\/div>"};u.meta=function(n){var t='<div class="ds-meta"><a href="javascript:void(0)" class="ds-like-thread-button ds-rounded';return n.user_vote>0&&(t+=" ds-thread-liked"),t+='"><span class="ds-icon ds-icon-heart"><\/span> <span class="ds-thread-like-text">',t+=n.user_vote>0?"已喜欢":"喜欢",t+'<\/span><span class="ds-thread-cancel-like">取消喜欢<\/span><\/a><span class="ds-like-panel"><\/span><\/div>'};u.notify=function(n){var t='<div id="ds-reset"><a class="ds-logo" href="http://duoshuo.com/" target="_blank" title="多说"><\/a><ul class="ds-notify-unread"><li';return n.comments||(t+=' style="display:none;"'),t+='><a data-type="unread-comments" href="javascript:void(0);">你有'+n.comments+"条新回复<\/a><\/li><li",n.notifications||(t+=' style="display:none;"'),t+('><a data-type="unread-notifications" href="javascript:void(0);">你有'+n.notifications+"条系统消息<\/a><\/li><\/ul><\/div>")};u.post=function(n){var i="",t=n.post,o=n.options,f=t.author,c,a,v,l,e,w;if(i+='<li class="ds-post" data-post-id="'+t.post_id+'"><div class="ds-post-self" data-post-id="'+t.post_id+'" data-thread-id="'+t.thread_id+'" data-root-id="'+t.root_id+'" data-source="'+t.source+'"><div class="ds-avatar"',f.user_id&&(i+=' data-user-id="'+f.user_id+'"'),i+=">"+u.avatar(f),r.sourceName[t.source]&&(i+=u.serviceIcon(t.source)),i+='<\/div><div class="ds-comment-body"><div class="ds-comment-header">',f.url?(i+='<a class="ds-user-name ds-highlight" data-qqt-account="'+(f.qqt_account||"")+'" href="'+h(f.url)+'" ',f.user_id&&(i+=" onclick=\"this.href='"+p()+"/user-url/?user_id="+f.user_id+"';\""),i+=' rel="nofollow" target="_blank"',f.user_id&&(i+=' data-user-id="'+f.user_id+'"'),i+=">"+h(f.name)+"<\/a>"):(i+='<span class="ds-user-name"',f.user_id&&(i+=' data-user-id="'+f.user_id+'"'),i+=' data-qqt-account="'+(f.qqt_account||"")+'">'+h(f.name)+"<\/span>"),i+='<span class="ua">'+sskua(t.agent)+'<\/span><span class="ua">'+sskos(t.agent)+"<\/span>",i+="<\/div>",1==o.max_depth&&o.show_context&&t.parents.length){if(i+='<ol id="ds-ctx">',c=y.getJSON(t.parents),c)for(e=-1,v=c.length-1;v>e;)a=c[e+=1],1==e&&t.parents.length>2&&(i+='<li class="ds-ctx-entry"><a href="javascript:void(0);" class="ds-expand">还有'+(t.parents.length-2)+"条评论<\/a><\/li>"),i+=u.ctxPost({post:a,index:e,hidden:e&&e<t.parents.length-1});i+="<\/ol>"}if(i+="<p>",t.parents.length>=o.max_depth&&(!o.show_context||o.max_depth>1)&&t.parent_id&&y[t.parent_id]&&(i+='<a class="ds-comment-context" data-post-id="'+t.post_id+'" data-parent-id="'+t.parent_id+'">'+s.reply_to+h(y[t.parent_id].toJSON().author.name)+": <\/a>"),i+=t.message+'<\/p><div class="ds-comment-footer ds-comment-actions',t.vote>0&&(i+=" ds-post-liked"),i+='">',i+=t.url?u.timeAnchor(t.created_at,t.url):u.timeText(t.created_at),"duoshuo"==t.source?(i+='<a class="ds-post-reply" href="javascript:void(0);"><span class="ds-icon ds-icon-reply"><\/span>'+s.reply+"<\/a>"+u.likePost(t)+'<a class="ds-post-repost" href="javascript:void(0);"><span class="ds-icon ds-icon-share"><\/span>'+s.repost+'<\/a><a class="ds-post-report" href="javascript:void(0);"><span class="ds-icon ds-icon-report"><\/span>'+s.report+"<\/a>",t.privileges["delete"]&&(i+='<a class="ds-post-delete" href="javascript:void(0);"><span class="ds-icon ds-icon-delete"><\/span>'+s["delete"]+"<\/a>")):("qqt"==t.source||"weibo"==t.source)&&(i+='<a class="ds-weibo-comments" href="javascript:void(0);">'+s.comments,t.type.match(/\-comment$/)||(i+='(<span class="ds-count">'+t.comments+"<\/span>)"),i+='<\/a><a class="ds-weibo-reposts" href="javascript:void(0);">'+s.reposts,t.type.match(/\-comment$/)||(i+='(<span class="ds-count">'+t.reposts+"<\/span>)"),i+="<\/a>"),i+="<\/div><\/div><\/div>",o.max_depth>1&&(t.childrenArray||t.children)&&"weibo"!=t.source&&"qqt"!=t.source){if(i+='<ul class="ds-children">',l=y.getJSON(t.childrenArray||t.children),l)for(e=-1,w=l.length-1;w>e;)t=l[e+=1],i+=u.post({post:t,options:o});i+="<\/ul>"}return i+"<\/li>"};u.postListHead=function(n){var t='<div class="ds-comments-info"><div class="ds-sort"><a class="ds-order-desc">'+s.latest+'<\/a><a class="ds-order-asc">'+s.earliest+'<\/a><a class="ds-order-hot">'+s.hottest+'<\/a><\/div><ul class="ds-comments-tabs"><li class="ds-tab"><a class="ds-comments-tab-duoshuo ds-current" href="javascript:void(0);"><\/a><\/li>';return n.options.show_reposts&&n.thread.reposts&&(t+='<li class="ds-tab"><a class="ds-comments-tab-repost" href="javascript:void(0);"><\/a><\/li>'),t+=" ",n.options.show_weibo&&n.thread.weibo_reposts&&(t+='<li class="ds-tab"><a class="ds-comments-tab-weibo" href="javascript:void(0);"><\/a><\/li>'),t+=" ",n.options.show_qqt&&n.thread.qqt_reposts&&(t+='<li class="ds-tab"><a class="ds-comments-tab-qqt" href="javascript:void(0);"><\/a><\/li>'),t+"<\/ul><\/div>"};u.recentVisitors=function(n){var r="",t=n.response,f,i,e;if(t)for(i=-1,e=t.length-1;e>i;)f=t[i+=1],r+='<div class="ds-avatar">'+u.avatar(f,n.options.avatar_size)+"<\/div>";return r};u["related-read"]=function(n){var t="",r,i,f,o,u,s,e,h;if(n&&n.length){if(t+='<article class="ds-reads-expand"><div class="ds-header">头条推荐<\/div><section> ',r=n,r)for(f=-1,o=r.length-1;o>f;){if(i=r[f+=1],t+=' <a href="'+i.url+'" class="ds-reads-item"> ',3==i.imgs.length){if(t+=" <h2>"+i.title+'<\/h2> <div class="ds-reads-pics"> <ul> ',u=i.imgs,u)for(e=-1,h=u.length-1;h>e;)s=u[e+=1],t+=' <li> <div class="ds-reads-dumb"><\/div> <div class="ds-reads-pic-wrap" style="background-image:url('+s+');"><\/div> <\/li> ';t+=' <\/ul> <\/div> <div class="ds-reads-info"> ';1==i.type&&(t+=' <span class="ds-reads-app-special">打开头条阅读<\/span> ');t+=' <span class="ds-reads-date" data-date="'+i.timeStamp+'"><\/span> <\/div> '}else t+=' <div class="ds-reads-desc ',i.imgs.length||(t+="ds-reads-only"),t+='"> <div class="ds-reads-title">'+i.title+'<\/div> <div class="ds-reads-info"> ',1==i.type&&(t+=' <span class="ds-reads-app-special">打开头条阅读<\/span> '),t+=' <span class="ds-reads-date" data-date="'+i.timeStamp+'"><\/span> <\/div> <\/div> ',i.imgs.length&&(t+=' <div class="ds-reads-pic-right"> <div class="ds-reads-dumb"><\/div> <div class="ds-reads-pic-wrap" style="background-image:url('+i.imgs[0]+');"> ',i.hasVideo&&(t+=' <div class="ds-reads-vid-info"><span>'+i.videoDuration+"<\/span><\/div> "),t+=" <\/div> <\/div> "),t+=" ";t+=" <\/a> "}t+="<\/section><\/article>"}return t};u.replybox=function(n){var t='<div class="ds-replybox"><a class="ds-avatar"',i;if(t+=g()?' href="javascript:void(0);" onclick="return false"':' href="'+r.REMOTE+"/settings/avatar/"+ht(ni())+'" target="_blank" title="设置头像"',t+=">"+u.avatarImg(c.data)+'<\/a><form method="post">'+si(n.params)+'<div class="ds-textarea-wrapper ds-rounded-top"><textarea name="message" title="Ctrl+Enter快捷提交" placeholder="'+h(s.leave_a_message)+'"><\/textarea><pre class="ds-hidden-text"><\/pre>',t+="<\/div>",t+='<div class="ds-post-toolbar"><div class="ds-post-options ds-gradient-bg"><span class="ds-sync">',!g()&&c.data.repostOptions){t+='<input id="ds-sync-checkbox';n.inline&&(t+="-inline");t+='" type="checkbox" name="repost" ';n.checked&&(t+='checked="checked" ');t+='value="'+n.repostArray.join(",")+'"> <label for="ds-sync-checkbox';n.inline&&(t+="-inline");t+='">'+s.share_to+"<\/label>";for(i in c.data.repostOptions)t+=u.serviceIcon(i,!c.data.repostOptions[i])}return t+="<\/span>",t+="<\/div>",t+='<button class="ds-post-button" type="submit">'+h(s.post)+'<\/button><div class="ds-toolbar-buttons">',n.options.use_smilies&&(t+='<a class="ds-toolbar-button ds-add-emote" title="插入表情"><\/a>'),n.options.use_images&&n.options.parse_html_enabled&&(t+='<a class="ds-toolbar-button ds-add-image" title="插入图片"><\/a>'),t+="<\/div><\/div>",t+"<\/form><\/div>"};u.serviceBindList=function(n){var i="",u=n,t,f,e;if(u)for(f=-1,e=u.length-1;e>f;)t=u[f+=1],i+='<li><a href="'+d.bindUrl(t)+'" rel="nofollow" class="ds-service-link ds-'+t+'">'+r.serviceNames[t],c.data.social_uid[t]&&(i+=' <span class="ds-icon ds-icon-ok"><\/span>'),i+="<\/a><\/li>";return i};u.serviceList=function(n){var f="",i=n,t,u,e;if(i)for(u=-1,e=i.length-1;e>u;)t=i[u+=1],f+='<li><a href="'+d.loginUrl(t)+'" rel="nofollow" class="ds-service-link ds-'+t+'">'+r.serviceNames[t]+"<\/a><\/li>";return f};u.shareWidget=function(n){var f='<div class="ds-share-icons"> <div class="ds-share-icons-inner"> <ul class="ds-share-icons-16"> ',i=n.services,t,u,e;if(i)for(u=-1,e=i.length-1;e>u;)t=i[u+=1],f+=' <li> <a class="ds-'+t+'" href="javascript:void(0);" data-service="'+t+'">'+r.sourceName[t]+"<\/a> <\/li> ";return f+(' <\/ul> <\/div> <div class="ds-share-icons-footer">'+n.copyright+"<\/div><\/div>")};u.smiliesTooltip=function(n){var t='<div id="ds-smilies-tooltip"><ul class="ds-smilies-tabs">';for(var i in n)t+="<li><a>"+i+"<\/a><\/li>";return t+'<\/ul><div class="ds-smilies-container"><\/div><\/div>'};u.toolbar=function(){var n='<div class="ds-toolbar"><div class="ds-account-control"><span class="ds-icon ds-icon-settings"><\/span> <span>帐号管理<\/span><ul><li><a class="ds-bind-more" href="javascript:void(0);" style="border-top: none">绑定更多<\/a><\/li><li><a target="_blank" href="'+r.REMOTE+"/settings/"+ht(ni())+'">'+h(s.settings)+'<\/a><\/li><li><a rel="nofollow" href="'+d.logoutUrl()+'" style="border-bottom: none">登出<\/a><\/li><\/ul><\/div><div class="ds-visitor">';return n+=c.data.url?'<a class="ds-visitor-name" href="'+h(c.data.url)+'" target="_blank">'+h(c.data.name)+"<\/a>":'<span class="ds-visitor-name">'+h(c.data.name)+"<\/span>",n+'<a class="ds-unread-comments-count" href="javascript:void(0);" title="新回复"><\/a><\/div><\/div>'};u.topThreads=function(n){var u="",i=n.response,t,r,f;if(i)for(r=-1,f=i.length-1;f>r;)t=i[r+=1],u+='<li><a target="_blank" href="'+h(t.url)+'" title="'+h(t.title)+'">'+h(t.title)+"<\/a><\/li>";return u};u.topUsers=function(n){var f="",t=n.response,i,r,e;if(t)for(r=-1,e=t.length-1;e>r;)i=t[r+=1],f+='<div class="ds-avatar">'+u.avatar(i,n.options.avatar_size)+"<h4>"+h(i.name)+"<\/h4><\/div>";return f};u.userInfo=function(n){var t='<a href="'+h(n.url)+'" onclick="this.href=\''+p()+"/user-url/?user_id="+n.user_id+'\';" class="ds-avatar" target="_blank">'+u.avatarImg(n)+'<\/a><a href="'+h(n.url)+'" onclick="this.href=\''+p()+"/user-url/?user_id="+n.user_id+'\';" class="ds-user-name ds-highlight" target="_blank">'+h(n.name)+"<\/a>";for(var i in n.social_uid)t+='<a href="'+r.REMOTE+"/user-proxy/"+i+"/"+n.social_uid[i]+'/" target="_blank" class="ds-service-icon ds-'+i+'" title="'+r.sourceName[i]+'"><\/a>';return t+='<p class="ds-user-card-meta"><a href="'+r.REMOTE+"/profile/"+n.user_id+'/" target="_blank"><span class="ds-highlight">'+n.comments+"<\/span>条评论<\/a><\/p>",n.description&&(t+='<p class="ds-user-description">'+h(n.description)+"<\/p>"),t};var e=r.Views={},tr=(r.Callbacks={},r.pagelets=[]),wi=r.events=new yt,et=r.site=new lt,c=r.visitor=new ui,tt=r.unread=new lt,wt=r.threadPool=new st(fi),y=r.postPool=new st(pt),it=r.userPool=new st(ui);wi.on("queryDefined",function(){var i=f.short_name,n,t;(f.theme&&hi(f.theme),a)&&(n=a["ds_site_"+i],t=a["ds_lang_"+i],n&&et.reset(w.parse(n)),t&&o.extend(s,w.parse(t)))});ti();r.require("embed.compat",function(){function bt(n){n.stopPropagation()}function ri(n){(n.ctrlKey&&13==n.which||10==n.which)&&h(this.form).trigger("submit")}function ei(){var n=h(this);n.height(Math.max(54,n.next(".ds-hidden-text").text(this.value).height()+27))}function ft(){if(v.authInWin){var n=this.href.match(/\/(login|bind)\/(\w+)\//i);if(n&&r.serviceNames[n[2]])return!hi(n[2],this.href)}}function ki(){var s,e,n,u,o,i=this,f=0,r=0;t.selection&&(e=t.selection.createRange(),e&&e.parentElement()==i&&(u=i.value.length,s=i.value.replace(/\r\n/g,"\n"),n=i.createTextRange(),n.moveToBookmark(e.getBookmark()),o=i.createTextRange(),o.collapse(!1),n.compareEndPoints("StartToEnd",o)>-1?f=r=u:(f=-n.moveStart("character",-u),f+=s.slice(0,f).split("\n").length-1,n.compareEndPoints("EndToEnd",o)>-1?r=u:(r=-n.moveEnd("character",-u),r+=s.slice(0,r).split("\n").length-1))));h(i).data("ds-range-start",f).data("ds-range-end",r)}function dt(n){return v.touch&&n.addClass("ds-touch"),o.cssProperty("transition")||n.addClass("ds-no-transition"),v.ie6&&n.addClass("ds-ie6"),v.opacity||n.addClass("ds-no-opacity"),n}function oi(n){if(!v.placeholder){var t=n.attr("placeholder");n.val(t).focus(function(){this.value===t&&(this.value="")}).blur(function(){""===this.value&&(this.value=t)})}return n}function si(n){if("http://duoshuo.com"===n.origin)switch(n.data.type){case"login":rt.href=n.data.redirectUrl}}function hi(t,i){var r={weibo:[760,600],renren:[420,322],qq:[504,445],weixin:[450,550],google:[600,440]}[t]||[550,400];return n.open(i+(-1==i.indexOf("?")?"?":"&")+o.param({origin:rt.origin||"http://"+rt.host}),"_blank","width="+r[0]+",height="+r[1]+",toolbar=no,menubar=no,location=yes")}function ci(n){var t=d[g()?"loginUrl":"bindUrl"](n);v.authInWin&&hi(n,t)||(rt.href=t)}function nr(){var n=ut(u["dialog-ask-for-auth"]({})).el.find(".ds-dialog").css("width","300px");n.find("a.ds-service-link").click(ft)}function li(n,t,i,f){function s(){function n(n){var t,e,u;i&&f&&(t=i.options,e=gt(i.postList.el,n.response[f],t),"asc"==t.order==("top"==t.formPosition)&&r.scrollTo(e),u=i.el.find(".ds-comments-tab-"+f+" span.ds-highlight"),u.html(parseInt(u.html())+1))}return f||e.find("[type=checkbox]:checked")[0]?(l.post("posts/repost",r.toJSON(e),n),o.close(),!1):(alert("还没有选发布到哪儿呢"),!1)}function h(){var n=this.value;this.checked&&!c.data.social_uid["qqt"==n?"qq":n]}var o=ut(u["dialog-reposts"]({post:n.toJSON(),repostMessage:t,service:f})),e=o.el.find("form");return e.submit(s),e.find(".ds-actions [type=checkbox]").change(h),oi(e.find("textarea")).keyup(ri).keyup(ei).focus(),!1}function ai(n){var t={"unread-comments":{title:"新留言及回复",apiUrl:"users/unreadComments",tmpl:function(n){return n.thread?'<li data-thread-id="'+n.thread.thread_id+'">'+h.map(n.authors,u.userAnchor).join("、")+' 在 <a class="ds-read" href="'+n.thread.url+'#comments" target="_blank">'+b(n.thread.title||"无标题")+'<\/a> 中回复了你 <a class="ds-delete ds-read" title="知道了" href="javascript:void(0)">知道了<\/a><\/li>':""},read:function(n){var t=n.attr("data-thread-id");l.post("threads/read",{thread_id:t});tt.data.comments--}},"unread-notifications":{title:"系统消息",apiUrl:"users/unreadNotifications",tmpl:function(n){return'<li data-notification-id="'+n.notification_id+'" data-notification-type="'+n.type+'">'+n.content+' <a class="ds-delete ds-read" title="知道了" href="javascript:void(0)">知道了<\/a><\/li>'},read:function(n){var t=n.attr("data-notification-id");l.post("notifications/read",{notification_id:t});tt.data.notifications--}}}[n],i=ut("<h2>"+t.title+'<\/h2><ul class="ds-unread-list"><\/ul>'),f;i.on("close",r.resetNotify);f=i.el.find(".ds-unread-list").delegate(".ds-delete","click",function(){return h(this).parent().remove(),0===f.children().length&&i.close(),!1}).delegate(".ds-read","click",function(){t.read(h(this).parent())});h("#ds-notify").hide();l.get(t.apiUrl,{},function(n){i.el.find(".ds-unread-list").html(h.map(n.response,t.tmpl).join("\n"))})}function yi(){bubbleOutTimer&&(clearTimeout(bubbleOutTimer),bubbleOutTimer=0)}function pi(){bubbleOutTimer=setTimeout(function(){bubbleOutTimer=0;w.detach()},400)}function gt(n,t,i){if(!n.find(".ds-post[data-post-id="+t.data.post_id+"]")[0])return(n.find(".ds-post-placeholder").remove(),h(u.post({post:t.toJSON(),options:i})).hide()["asc"==i.order?"appendTo":"prependTo"](n).slideDown(function(){}))}function wi(n,t){function r(){if(g())return nr(),!1;var n=h(this).parent(),t=n.hasClass("ds-post-liked"),i=h(this).html().match(/\((\d+)\)/),r=(i?parseInt(i[1]):0)+(t?-1:1);return l.post("posts/vote",{post_id:n.closest(".ds-ctx-entry, .ds-post-self").attr("data-post-id"),vote:t?0:1}),h(this).html(h(this).html().replace(/\(\d+\)/,"")+(r?"("+r+")":"")),n[t?"removeClass":"addClass"]("ds-post-liked"),!1}function f(){var n=h(this).closest(".ds-post-self"),t=y[n.attr("data-post-id")];return li(t,""),!1}function o(){if(!confirm("确定要删除这条评论吗？"))return!1;var t=h(this).closest(".ds-post-self");return l.post("posts/remove",{post_id:t.attr("data-post-id")}),t.parent().fadeOut(200,function(){n.data.comments--;n.updateCounter("duoshuo");h(this).remove()}),!1}function s(){if(!confirm("确定要举报这条评论吗？"))return!1;var n=h(this).closest(".ds-post-self");return l.post("posts/report",{post_id:n.attr("data-post-id")}),alert("感谢您的反馈！"),!1}function a(){var u=h(this),f=u.closest(".ds-comment-actions"),r;return f.hasClass("ds-reply-active")?(i.el.fadeOut(200,function(){h(this).detach()}),f.removeClass("ds-reply-active")):(r=u.closest(".ds-ctx-entry, .ds-post-self"),i?i.actionsBar.removeClass("ds-reply-active"):(i=new e.Replybox(n),i.render(!0).el.addClass("ds-inline-replybox").detach()),i.el.find("[name=parent_id]").val(r.attr("data-post-id")),i.el.show().appendTo(u.closest(".ds-ctx-body, .ds-comment-body")).find("textarea").focus(),i.actionsBar=f.addClass("ds-reply-active"),t.max_depth<=1?i.postList=n.postList.el:(i.postList=r.siblings(".ds-children"),i.postList[0]||(i.postList=h('<ul class="ds-children"><\/ul>').insertAfter(r)))),!1}function p(){function r(n){vt(n);i.append(h.map(n.response,function(n){return u.post({post:n,options:t})}).join(""))}var n=h(this).closest(".ds-post-self"),f=n.attr("data-post-id"),i;return(n.data("source"),0!=n.attr("data-root-id"))?!1:(i=n.siblings(".ds-children"),i[0]?(i.remove(),!1):(i=h('<ul class="ds-children"><\/ul>').insertAfter(n),l.get("posts/listComments",ot({post_id:f}),r),!1))}function b(){var e=h(this).closest(".ds-post-self"),t=y[e.attr("data-post-id")],i=t.data.source,u;if(!c.data.social_uid["qqt"==i?"qq":i])return void ci(i);var r=t.data.root_id,o="0"!=r?y[r]:t,f="";return"0"!=r&&(u=prepatePost(t.data).theAuthor,f=("weibo"==i?"//@"+u.name:"|| @"+u.qqt_account)+":"+t.data.message),li(o,f,n,i),!1}function k(){var n=h(this).parent();return n.siblings().show(),n.remove(),!1}function d(){function r(){function h(n){var t=n.response;it[r]?it[r].set(t):it[r]=new ui(t);w.owner==i&&st.html(u.userInfo(t))}var f,r;ht=0;w.owner=i;yi();var e=t.offset(),o=n.el.offset(),s=t.innerWidth()/2,c=n.el.innerHeight()-(e.top-o.top)+6,a=e.left-o.left-35+(s>35?35:s);try{if(t.hasClass("ds-comment-context"))st.attr("id","ds-ctx-bubble").attr("data-post-id",t.attr("data-post-id")).html('<ul id="ds-ctx">'+u.ctxPost({post:y[t.attr("data-parent-id")].toJSON()})+'<\/ul><div class="ds-bubble-footer"><a class="ds-ctx-open" href="javascript:void(0);">查看对话<\/a><\/div>');else if(t.hasClass("ds-avatar")||t.hasClass("ds-user-name")){if(f={},r=f.user_id=t.attr("data-user-id"),!r)throw"no info";st.attr("id","ds-user-card").attr("data-user-id",r).empty();it[r]?st.html(u.userInfo(it[r].data)):l.get("users/profile",ot(f),h)}w.css({bottom:c,left:a}).appendTo(n.innerEl)}catch(v){w.detach()}}var i=this,t;if(bubbleOutTimer&&w.owner==i)return clearTimeout(bubbleOutTimer),void(bubbleOutTimer=0);t=h(i);ht=setTimeout(r,200)}function nt(){ht?(clearTimeout(ht),ht=0):bubbleOutTimer||pi()}var i;this.delegate("a.ds-post-likes","click",r).delegate("a.ds-post-repost","click",f).delegate("a.ds-post-delete","click",o).delegate("a.ds-post-report","click",s).delegate("a.ds-post-reply","click",a).delegate("a.ds-weibo-comments","click",p).delegate("a.ds-weibo-reposts","click",b).delegate("a.ds-expand","click",k);v.touch||this.delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseenter",d).delegate("a.ds-comment-context, .ds-avatar, .ds-user-name","mouseleave",nt)}function ot(n){var i={require:"site,visitor,nonce,lang"+(ni++?"":",unread,log,extraCss"),site_ims:at.get("ds_site_"+f.short_name+":timestamp"),lang_ims:at.get("ds_lang_"+f.short_name+":timestamp"),referer:t.referrer},r;f.stylePatch&&(i.style_patch=f.stylePatch);for(r in i)i[r]&&(!v.ie6||encodeURIComponent(i[r]).length<200)&&(n[r]=i[r]);return n}var h=r.jQuery,lt=h(n),bi=h(t),ni;n.postMessage&&(n.addEventListener?n.addEventListener("message",si,!1):n.attachEvent&&n.attachEvent("onmessage",si));r.scrollTo=function(n){var t=n.offset().top;(t<lt.scrollTop()||t>lt.scrollTop()+lt.height())&&h("html, body").animate({scrollTop:t-40},200,"swing")};r.toJSON=function(n){var t=/\r?\n/g,r=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,u=/^(?:select|textarea)/i,f=n.map(function(){return this.elements?h.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||u.test(this.nodeName)||r.test(this.type))}).map(function(n,i){var r=h(this).val();return null==r?null:h.isArray(r)?h.map(r,function(n){return{name:i.name,value:n.replace(t,"\r\n")}}):{name:i.name,value:r.replace(t,"\r\n")}}).toArray(),i={};return h.each(f,function(){i[this.name]=this.value}),i};r.resetNotify=function(){var n=h("#ds-notify"),i=tt.data;n[0]||(n=h('<div id="ds-notify"><\/div>').css({hidden:{display:"none"},"top-right":{top:"24px",right:"24px"},"bottom-right":{bottom:"24px",right:"24px"}}[et.data.notify_position]).delegate(".ds-notify-unread a","click",function(){return ai(h(this).data("type")),!1}).appendTo(t.body));n.html(u.notify(i))[!i.comments&&!i.notifications||"hidden"===et.data.notify_position||h(".ds-dialog")[0]?"hide":"show"]()};tt.on("reset",r.resetNotify);e.Replybox=function(n){this.embedThread=n};e.Replybox.prototype={render:function(n){function at(n){n.data("submitting",!0);n.find(".ds-post-button").addClass("ds-waiting").html(s.posting)[0].disabled=!0}function st(n){n.data("submitting",!1);n.find(".ds-post-button").removeClass("ds-waiting").html(s.post)[0].disabled=!1}var o=this,w=o.embedThread,p=w.options,ht=function(){r.require("smilies",function(){})},it={thread:w,options:p,inline:n,params:{thread_id:w.threadId,parent_id:"",nonce:r.nonce},repostArray:[],checked:0},rt,nt,ot,tt;for(rt in c.data.repostOptions)c.data.repostOptions[rt]&&(it.repostArray.push(rt),it.checked=1);var b=o.el=h(u.replybox(it)).click(ht),i=b.find("form"),k=i.find("input[type=checkbox]")[0],d=i.find("a.ds-service-icon, a.ds-service-icon-grey"),f=oi(i.find("textarea")).focus(ht).keyup(ri).keyup(ei).bind("focus mousedown mouseup keyup",ki),ct=b.find(".ds-add-emote").click(function(n){var i=r.smiliesTooltip;return ct.toggleClass("ds-expanded").hasClass("ds-expanded")?(i||(i=r.smiliesTooltip=new e.SmiliesTooltip,i.render(),r.require("smilies",function(){i.reset("微博-默认")})),i.replybox=o,i.el.appendTo(t.body).css({top:o.el.offset().top+o.el.outerHeight()+4+"px",left:o.el.find(".ds-textarea-wrapper").offset().left+"px"}),h(t.body).click(et)):et(n),!1}),et=(b.find(".ds-add-image").click(function(n){var i=f[0],r=i.value,u="请输入图片地址",s='<img src="'+u+'" />',e,o;t.selection?(i.value=r.substring(0,f.data("ds-range-start"))+s+r.substring(f.data("ds-range-end"),r.length),i.value=i.value.replace("说点什么吧 ...",""),i.focus(),e=t.selection.createRange(),e.collapse(),e.findText(u),e.select()):(i.value=r.substring(0,i.selectionStart)+s+r.substring(i.selectionEnd),o=i.value.search(u),i.setSelectionRange(o,o+u.length),i.focus());n.preventDefault()}),o.hideSmilies=function(){ct.removeClass("ds-expanded");r.smiliesTooltip.el.detach();h(t.body).unbind("click",et)}),lt=function(n,t){var f=ut(u["dialog-anonymous"]({services:["weixin","weibo","qq","renren","kaixin","douban"],options:p})),e=f.el.find(".ds-dialog").css("width","320px"),i;(e.find(".ds-icons-32 a").click(ft),p.deny_anonymous)||(i=f.el.find("form"),i.submit(function(){var n=i.find("input[name=author_email]").val();return!n&&!p.require_guest_email||n.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)?(t(r.toJSON(i)),f.close(),!1):(alert("请输入一个有效的email地址."),!1)}),i.find("input[name=author_name]")[0].focus())};return p.deny_anonymous&&f.focus(function(){if(g()){lt(i,nt);var n=function(t){t.stopPropagation();f.unbind("click",n)};f.click(n)}return!1}),nt=function(n){at(i);l.post("posts/create",h.extend(r.toJSON(i),n),function(n){var t=y[n.response.post_id]=new pt(n.response),u=gt(o.postList,t,p);if("asc"==p.order==("top"==p.formPosition)&&r.scrollTo(u),w.data.comments++,w.updateCounter("duoshuo"),f.val("").trigger("keyup"),st(i),b.hasClass("ds-inline-replybox")&&(b.detach(),o.actionsBar.removeClass("ds-reply-active")),a)try{a.removeItem("ds_draft_"+w.threadId)}catch(e){}},function(n){st(i);alert(n.errorMessage)})},i.submit(function(){if(i.data("submitting"))return!1;var n=h.trim(i[0].message.value);return""==n||!v.placeholder&&n==f.attr("placeholder")?(alert("您还没写内容呢"),!1):(g()?lt(i,nt):nt(),!1)}),ot=function(n){return h(n).hasClass("ds-service-icon-grey")?null:h(n).attr("data-service")},(d.click(function(){return h(this).toggleClass("ds-service-icon-grey").toggleClass("ds-service-icon"),k.value=h.map(d,ot).join(","),k.checked=""!=k.value,!1}),h(k).change(function(){var n=this.checked;d[n?"removeClass":"addClass"]("ds-service-icon-grey")[n?"addClass":"removeClass"]("ds-service-icon");this.value=h.map(d,ot).join(",")}),!n&&a)&&(tt="ds_draft_"+w.threadId,f.bind("focus blur keyup",function(n){var t=h(n.currentTarget).val();try{a[tt]=t}catch(n){}}),a[tt]&&f.val(a[tt])),this}};e.Dialog=yt.extend({init:function(n,t){(this.el=h("#ds-wrapper"))[0]||(this.el=dt(h('<div id="ds-wrapper"><\/div>')));this.options=h.extend({width:600},t);n!==i&&h(n).attr("id","ds-reset").appendTo(this.el)},open:function(){function i(t){if(27==t.which)return(n.close(),!1)}function r(){return n.close(),!1}var n=this;return n.el.hide().appendTo(t.body).fadeIn(200),v.ie6&&n.el.css("top",lt.scrollTop()+100),n.el.show().find(".ds-dialog").delegate("a.ds-dialog-close","click",function(){return n.close(),!1}).click(bt),bi.keydown(i),h(t.body).click(r),n.close=function(){bi.unbind("keydown",i);h(t.body).unbind("click",r);n.el.fadeOut(200,function(){h(this).remove()});n.trigger("close")},n}});u.likePanel=function(n){return n.likes?'<span class="ds-highlight">'+n.likes+"<\/span> 人喜欢":""};e.Meta=function(n){this.embedThread=n};e.Meta.prototype={render:function(){function s(s){function p(n){o.set(n);r.resetLikePanel()}function c(){r.tooltip.detach();h(t.body).unbind("click",c)}function w(t){switch(this.className){case"ds-like-tooltip-close":c(t);break;default:if(!n.open(this.href,"_blank","height=500,width=600,top=0,left=0,toolbar=no,menubar=no,resizable=yes,location=yes,status=no"))return}return!1}var v=e.hasClass("ds-thread-liked"),y,a;return(l.post("threads/vote",{thread_id:r.embedThread.threadId,vote:v?0:1},p),e.toggleClass("ds-thread-liked"),e.find(".ds-thread-like-text").text(v?"喜欢":"已喜欢"),v)?(r.tooltip&&c(s),!1):(r.tooltip===i&&(y=u.likeTooltip({services:{qzone:"QQ空间",weibo:"新浪微博",qqt:"腾讯微博",renren:"人人网",kaixin:"开心网",douban:"豆瓣网",baidu:"百度搜藏"},thread_id:o.data.thread_id}),r.tooltip=h(y).click(bt).delegate("a","click",w)),a={},a.left=0,a.top=f.position().top+f.outerHeight()-4+"px",r.tooltip.appendTo(r.embedThread.innerEl).css(a),h(t.body).click(c),!1)}var r=this,o=r.embedThread.model,f=r.el=h(u.meta(o.toJSON())),e=f.find(".ds-like-thread-button");return e.click(s),r.resetLikePanel(),g()&&f.hide(),r},resetLikePanel:function(){this.el.find(".ds-like-panel").html(u.likePanel(this.embedThread.model.toJSON()))}};e.PostListHead=function(n){this.embedThread=n};e.PostListHead.prototype={render:function(){function e(i){f.find("a.ds-current").removeClass("ds-current");n.params.page=1;var r=i.currentTarget;switch(r.className){case"ds-comments-tab-duoshuo":n.params.source="duoshuo";t.replybox.el.show();break;case"ds-comments-tab-repost":n.params.source="repost";t.replybox.el.hide();break;case"ds-comments-tab-weibo":n.params.source="weibo";t.replybox.el.hide();break;case"ds-comments-tab-qqt":n.params.source="qqt";t.replybox.el.hide()}return h(r).addClass("ds-current"),n.refetch(),!1}function o(){return i.find("a.ds-current").removeClass("ds-current"),n.params.order=t.options.order=this.className.replace("ds-order-",""),n.params.page=1,n.refetch(),h(this).addClass("ds-current"),!1}var t=this.embedThread,n=t.postList,r=this.el=h(u.postListHead({thread:t.model.toJSON(),options:t.options})),f=r.find("ul.ds-comments-tabs"),i;return f.delegate(".ds-tab a","click",e),i=r.find(".ds-sort"),i.delegate("a","click",o),i.find(".ds-order-"+n.params.order).addClass("ds-current"),this}};e.Paginator=function(n){function u(){return r.params.page=parseInt(this.innerHTML),r.refetch(),i.find(".ds-current").removeClass("ds-current"),h(this).addClass("ds-current"),!1}n=n||{};var t=this,i=t.el=n.el||h('<div class="ds-paginator"><\/div>'),r=t.collection=n.collection;i.delegate("a","click",u)};e.Paginator.prototype={reset:function(n){function u(n){r.push('<a data-page="'+n+'" href="javascript:void(0);">'+n+"<\/a>")}var t,i=this.collection.params.page||1,r=[];if(i>1)for(u(1),t=i>4?i-2:2,t>2&&r.push('<span class="page-break">...<\/span>');i>t;t++)u(t);if(r.push('<a data-page="'+i+'" href="javascript:void(0);" class="ds-current">'+i+"<\/a>"),i<n.pages){for(t=i+1;i+4>=t&&t<n.pages;t++)u(t);t<n.pages&&r.push('<span class="page-break">...<\/span>');u(n.pages)}this.el.html('<div class="ds-border"><\/div>'+r.join(" "))[n.pages>1?"show":"hide"]()}};r.addSmilies=function(n,t){var i=r.smiliesTooltip;i&&i.el.find("ul.ds-smilies-tabs").append("<li><a>"+n+"<\/a><\/li>");r.smilies[n]=t};e.SmiliesTooltip=function(){};e.SmiliesTooltip.prototype={render:function(){function r(){var o=n.replybox,u=o.el.find("textarea"),i=u[0],r=i.value,f,e;t.selection?(i.value=r.substring(0,u.data("ds-range-start"))+this.title+r.substring(u.data("ds-range-end"),r.length),i.value=i.value.replace(s.leave_a_message,""),i.focus(),f=t.selection.createRange(),f.moveStart("character",u.data("ds-range-start")+this.title.length),f.collapse(),f.select()):(e=i.selectionStart+this.title.length,i.value=r.substring(0,i.selectionStart)+this.title+r.substring(i.selectionEnd),i.setSelectionRange(e,e));o.hideSmilies();i.focus()}var n=this,i=n.el=h(u.smiliesTooltip(vi));return i.click(bt).find("ul.ds-smilies-tabs").delegate("a","click",function(){n.reset(this.innerHTML)}),i.find(".ds-smilies-container").delegate("img","click",r),this},reset:function(n){function u(i,u){var f=0===n.indexOf("微博")?"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/"+u.replace("_org","_thumb"):r.STATIC_URL+"/images/smilies/"+u;"WordPress"===n&&(i=" "+i+" ");t+='<li><img src="'+f+'" title="'+b(i)+'" /><\/li>'}var i=this.el.find("ul.ds-smilies-tabs"),t;return i.find("a.ds-current").removeClass("ds-current"),i.find("a").filter(function(){return this.innerHTML==n}).addClass("ds-current"),t="<ul>",h.each(vi[n],u),t+="<\/ul>",this.el.find(".ds-smilies-container").html(t),this}};u.postPlaceholder=function(){return['<li class="ds-post ds-post-placeholder">',s.no_comments_yet,"<\/li>"].join("")};var w=h('<div id="ds-bubble"><div class="ds-bubble-content"><\/div><div class="ds-arrow ds-arrow-down ds-arrow-border"><\/div><div class="ds-arrow ds-arrow-down"><\/div><\/div>'),st=w.find(".ds-bubble-content").delegate("a.ds-ctx-open","click",function(){function i(t){function i(n,t){return u.ctxPost({post:n,index:t})}k.log(h.map(t.response,i).join("\n"));n.el.find("ol");n.el.find("ol").html(h.map(t.response,i).join("\n"))}var t={},n;return t.post_id=st.attr("data-post-id"),l.get("posts/conversation",t,i),n=ut('<h2>查看对话<\/h2><ol id="ds-ctx"><\/ol>'),n.el.find(".ds-dialog").css("width","600px"),n.el.find(".ds-dialog-body").css({"max-height":"350px",_height:"350px","overflow-y":"auto","padding-top":"10px"}),!1}),ht=bubbleOutTimer=0;w.mouseenter(yi).mouseleave(pi);e.PostList=function(n){n&&(n.params&&(this.params=n.params),n.embedThread&&(this.embedThread=n.embedThread));this.el=h('<ul class="ds-comments"><\/ul>')};e.PostList.prototype={url:"threads/listPosts",render:function(){return wi.call(this.el,this.embedThread,this.embedThread.options),this},reset:function(n){var t=this.embedThread.options;this.el.html(n[0]?h.map(y.getJSON(n),function(n){return u.post({post:n,options:t})}).join(""):u.postPlaceholder())},refetch:function(){function i(t){y.set(t.parentPosts||t.relatedPosts);it.set(t.users);n.reset(t.response);n.embedThread.paginator.reset(t.cursor);n.el.fadeTo(200,1);r.scrollTo(n.el);f.remove()}var n=this,f=h(u.indicator()).appendTo(t.body).fadeIn(200);n.el.fadeTo(200,.5);l.get(n.url,n.params,i)}};e.RelatedRead=function(){this._init()};e.RelatedRead.prototype={_init:function(){this.el=h('<div id="ds-related-reads"><\/div>')},load:function(i){n.__duoshuo_id__=i;n.readsByToutiao=[];n.readsByToutiao.push({id:"ds-related-reads",num:3});var r=t.createElement("script");r.src="//s0.pstatp.com/site/reads-sdk/5bf3702b38076207bee1.js";r.charset="utf-8";r.crossOrigin="anonymous";t.head.appendChild(r)},mount:function(n){this.el.insertBefore(n)}};e.EmbedThread=nt.extend({uri:"threads/listPosts",params:"thread-id local-thread-id source-thread-id thread-key category channel-key author-key author-id url limit order max-depth form-position container-url"+(kt.match(/MSIE 6\.0/)?"":" title image thumbnail"),render:function(){var n=this.el,t,i;if("请将此处替换成文章在你的站点中的ID"===n.data("thread-key"))return alert("请设置正确的 data-thread-key 属性"),!1;n.attr("id","ds-thread").append(u.waitingImg());t=n.width();i=n.data("url")||!n.attr("data-thread-id")&&h("link[rel=canonical]").attr("href");i?n.data("url",di(i)):n.data("container-url",rt.href);t&&400>=t&&n.addClass("ds-narrow").data("max-depth",1)},updateCounter:function(n){function i(n){return n.substr(n.indexOf("}")+1)}var u={duoshuo:["comments",i(s.comments_multiple)||"评论"],repost:["reposts",i(s.reposts_multiple)||"转载"],weibo:["weibo_reposts",i(s.weibo_reposts_multiple)||"新浪微博"],qqt:["qqt_reposts",i(s.qqt_reposts_multiple)||"腾讯微博"]},t,r;for(t in u)n&&n!=t||(r=this.data[u[t][0]],this.el.find(".ds-comments-tab-"+t).html(this.el.hasClass("ds-narrow")?'<span class="ds-service-icon ds-'+t+'"><\/span>'+r:(r?'<span class="ds-highlight">'+r+"<\/span>":"0")+u[t][1]))},onError:function(n){this.el.html("评论框出错啦("+n.code+"): "+n.errorMessage)},onload:function(t){var f=this,a=f.threadId=t.thread.thread_id,v=t.cursor,o=f.options=t.options,s=f.innerEl=dt(h('<div id="ds-reset"><\/div>').appendTo(f.el)),c,l;f.model=new fi(f.data=t.thread);y.set(t.parentPosts||t.relatedPosts);it.set(t.users);f.el.find("#ds-waiting").remove();t.options&&t.options.show_recommend&&(f.relatedRead=new e.RelatedRead,f.relatedRead.load(t.thread.site_id),f.relatedRead.mount(s));o.like_thread_enabled&&(f.meta=new e.Meta(f),s.append(f.meta.render().el));o.hot_posts&&t.hotPosts&&t.hotPosts.length&&(f.hotPosts=new e.HotPosts(h('<div class="ds-rounded"><\/div>'),{max_depth:1,show_context:o.show_context}),f.hotPosts.thread=f,s.append(f.hotPosts.el),f.hotPosts.onload({list:y.getJSON(t.hotPosts)}));f.postListHead=new e.PostListHead(f);f.postList=new e.PostList({embedThread:f,params:{source:"duoshuo",thread_id:a,max_depth:o.max_depth,order:o.order,limit:o.limit}});f.postList.render().reset(t.response);f.paginator=new e.Paginator({collection:f.postList});f.paginator.reset(v);c=f.replybox=new e.Replybox(f);c.postList=f.postList.el;g()?f.loginButtons=h(u.loginButtons()).delegate("a.ds-more-services","click",function(){return f.loginButtons.find(".ds-additional-services").toggle(),!1}).delegate("a.ds-service-link","click",ft):f.toolbar=h(u.toolbar()).delegate(".ds-account-control","mouseenter",function(){h(this).addClass("ds-active")}).delegate(".ds-account-control","mouseleave",function(){h(this).removeClass("ds-active")}).delegate("a.ds-bind-more","click",function(){var n=ut(u["dialog-bind-more"]()).el.find(".ds-dialog").addClass("ds-dialog-bind-more").css("width","300px");return n.find("a.ds-service-link").click(ft),!1}).delegate("a.ds-unread-comments-count","click",function(){return ai("unread-comments"),!1});l=['<a name="respond"><\/a>',f.toolbar||f.loginButtons,c.render().el];"top"==o.formPosition&&h.fn.append.apply(s,l);s.append(f.postListHead.render().el,f.postList.el,f.paginator.el);"bottom"==o.formPosition&&h.fn.append.apply(s,l);s.append(u.poweredBy(o.poweredby_text));f.updateCounter();t.alerts&&h.each(t.alerts,function(n,t){h('<div class="ds-alert">'+t+"<\/div>").insertBefore(f.toolbar||loginButtons)});o.message&&c.el.find("textarea").val(o.message).focus();tt.on("reset",function(){var n=tt.data.comments||0;s.find("a.ds-unread-comments-count").html(n).attr("title",n?"你有"+n+"条新回复":"你没有新回复").css("display",n?"inline":"none")});o.mzadx_id&&(r.require("mzadxN",function(){}),h('<div id="MZADX_'+o.mzadx_id+'" style="margin:0 auto;"><\/div>').appendTo(s),__mz_rpq=n.__mz_rpq||[],__mz_rpq.push({l:[o.mzadx_id],r:"1",_srv:"MZADX",_callback:function(){}}));r.thread=f;tt.data!==i&&tt.trigger("reset");g()||ii.send({visit_thread_id:f.threadId})},onMessage:function(n){gt(this.postList.el,new pt(n),this.options)}});e.HotPosts=nt.extend({tmpl:"hotPosts",params:"show-quote",render:function(){return this.el.attr("id","ds-hot-posts"),this},onload:function(n){n.options=h.extend(this.options,n.options);nt.prototype.onload.call(this,n);wi.call(this.el.find("ul"),this.thread,this.options)}});e.RecentComments=nt.extend({tmpl:"commentList",uri:"sites/listRecentPosts",params:"show-avatars show-time show-title avatar-size show-admin excerpt-length num-items channel-key",render:function(){this.el.attr("id","ds-recent-comments")},prepare:function(n){return{list:h.map(n.response,function(n){return new pt(n).toJSON()})}}});e.RecentVisitors=nt.extend({tmpl:"recentVisitors",uri:"sites/listVisitors",params:"show-time avatar-size num-items channel-key",render:function(){this.el.children().detach();this.el.attr("id","ds-recent-visitors").append(this.waitingEl=h(u.waitingImg()))}});e.TopThreads=nt.extend({tmpl:"topThreads",uri:"sites/listTopThreads",params:"range num-items channel-key",render:function(){this.el.children().detach();this.el.attr("id","ds-top-threads").append(this.waitingEl=h(u.waitingImg()))}});e.LoginWidget=nt.extend({tmpl:"loginWidget",render:function(){var n=this.el;n.attr("id","ds-login").html(u.loginWidget(["weixin","weibo","qq","renren","kaixin","douban"]));n.find("a").click(ft);n.find("a.ds-logout").attr("href",d.logoutUrl())}});e.ThreadCount=nt.extend({onload:function(n){var t=this.el,r=t.data("count-type")||"comments",i=n.data[r];t[t.data("replace")?"replaceWith":"html"](s[r+"_"+(i?i>1?"multiple":"one":"zero")].replace("{num}",i))}});e.ShareWidget=nt.extend({tmpl:"shareWidget",render:function(){var n={copyright:"多说分享插件",services:["weibo","qzone","sohu","renren","netease","qqt","kaixin","douban","qq","meilishuo","mogujie","baidu","taobao","google","wechat","diandian","huaban","duitang","youdao","pengyou","facebook","twitter","linkedin","msn"]};this.el.attr("id","ds-share");this.el.children().attr("id","ds-reset");this.el.find(".ds-share-aside-inner").html(u.shareWidget(n));this.el.find(".ds-share-icons-more").html(u.shareWidget(n));this.el.find(".ds-share-icons-more").hide();this.el.hasClass("flat")&&this.el.find("a").each(function(){h(this).addClass("flat")});dt(this.el);this.delegateEvents()},delegateEvents:function(){var a=this,i=a.el,c,r,f;if(i.children().hasClass("ds-share-inline")){var s=".ds-share-icons-more",e=i.find(s),l="[data-toggle=ds-share-icons-more]";i.delegate(l,"mouseover",function(){e.show()});i.delegate(l,"mouseout",function(){e.hide()});i.delegate(s,"mouseover",function(){e.show()});i.delegate(s,"mouseout",function(){e.hide()})}else c=i.children().hasClass("ds-share-aside-left")?"slide-to-right":"slide-to-left",r=i.children(),o.cssProperty("transition")||(f=i.children().hasClass("ds-share-aside-left")?"left":"right",i.delegate(".ds-share-aside-toggle","mouseover",function(){var n={},i=v.ie6&&"right"===f;i?n.left=(t.documentElement.scrollLeft+t.documentElement.clientWidth-this.offsetWidth-(parseInt(this.currentStyle.marginLeft,10)||0)-parseInt(this.currentStyle.marginRight,10)||0)-195:n[f]=0;r.animate(n,200)}),i.delegate(".ds-share-aside-inner","mouseleave",function(){var n={},i=v.ie6&&"right"===f;i?n.left=(t.documentElement.scrollLeft+t.documentElement.clientWidth-this.offsetWidth-(parseInt(this.currentStyle.marginLeft,10)||0)-parseInt(this.currentStyle.marginRight,10)||0)+230:n[f]=-229;r.animate(n,200)})),i.delegate(".ds-share-aside-toggle,.ds-share-aside-inner","mouseover",function(){r.addClass(c)}),i.delegate(".ds-share-aside-toggle,.ds-share-aside-inner","mouseleave",function(){r.removeClass(c)});i.delegate("a","click",function(t){var f=h(this).data("service"),r;if(!i.data("url"))return void alert("请设置data-url");if("wechat"===f){var e=p()+"/api/qrcode/getImage.png",s="?size=240&text="+i.data("url"),c=ut(u["dialog-qrcode"]({qrcode_url:e+s,url:i.data("url")}));c.el.find(".ds-dialog").css("width","320px")}else r=p()+"/share-proxy/?"+o.param({service:h(this).data("service"),thread_key:i.data("threadKey"),title:i.data("title"),images:i.data("images"),content:i.data("content"),url:i.data("url")}),n.open(r,"_blank");t.preventDefault();t.stopPropagation()})}});ni=0;r.initSelector=function(n,t){function r(n){vt(n);o.extend(s,n.options);wt.set(n.response)}var i=[];ti()&&(h.isReady||!gi)&&h(n).each(function(n,r){var u=h(r),f,o,s;u.data("initialized")||(u.data("initialized",!0),f=new e[t.type](u,t),(tr.push(f),"ThreadCount"===t.type)?(o=u.attr("data-thread-key"),u.attr("data-channel-key")&&(o=u.attr("data-channel-key")+":"+o),i.push(o),wt[o]||(wt[o]=new fi({})),wt[o].on("reset",function(){f.onload(this)})):f.uri&&(s={},h.each(f.params.split(" "),function(n,t){s[t.replace(/-/g,"_")]=u.attr("data-"+t)||u.data(t)}),l.get(f.uri,ot(s),function(n){f.load(n)})))});i.length&&l.get("threads/counts",ot({threads:i.join(",")}),r)};(r.initView=function(){h.each(ct,r.initSelector)})();h(function(){if(!f){if(!ti())return k.error("缺少 duoshuoQuery 的定义");k.warn("请在加载多说 embed.js 之前定义 duoshuoQuery")}setInterval(function(){h(".ds-time").each(function(){var n=h(this).attr("datetime");n&&(this.innerHTML=r.elapsedTime(n))})},2e4);f.ondomready&&f.ondomready();r.initView();!ni&&f.short_name&&l.get("analytics/ping",ot({}),vt)})})}}(window,document);
/*
//# sourceMappingURL=embed.min.js.map
*/